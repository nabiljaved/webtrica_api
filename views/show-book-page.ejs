<!DOCTYPE html>
<html lang="en">

<head>
    <title>Canadian Digital Driving School</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/navbar.css">
    <link rel="stylesheet" type="text/css" href="/css/style.css">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Vidaloka" rel="stylesheet">
    <style>
        /* Make the image fully responsive */
        
        .carousel-inner img {
            width: 100%;
            height: 100%;
        }
        
        #ul-list>li {
            text-align: center;
            padding: 10px;
        }
        
        .card-header {
            text-align: center;
        }
        
        .card-body h1 {
            text-align: center;
        }
    </style>
</head>

<body>

    <div class="navigation-wrap  start-header start-style">
        <div class="top-nav-1">
            <div class="">
                <div class="row">
                    <div class="col-sm-7">
                        <p class="top-nav-1-text-1"> MTO Approved. Beginner Driving Education Course Provider Gain eligibility for insurance discount</p>
                    </div>


                    <div class="col">
                        <span class="top-nav-1-text-1" id="show">Select Location</span>

                        <!---show locations here -->
                        <select class="make-payment-select-2" name="forma1" id="show_locations">
               
</select>



                    </div>



                </div>


            </div>



        </div>
        <div class="">
            <div class="row">
                <div class="col-12">
                    <nav class="navbar navbar-expand-md navbar-light">

                        <a class="navbar-brand" href="/">
                            <img src="img/logo.png" class="img-fluid">
                        </a>

                        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>

                        <div class="collapse navbar-collapse" id="navbarSupportedContent">
                            <ul class="navbar-nav ml-5 py-4 py-md-0">
                                <li class="nav-item1 pl-4 pl-md-0 ml-0 ml-md-4 active">
                                    <a href="/home" class="nav-link1">Home</a>
                                </li>
                                <li class="nav-item1 pl-4 pl-md-0 ml-0 ml-md-4">
                                    <a href="/package" class="nav-link1">Packages</a>
                                </li>
                                <li class="nav-item1 pl-4 pl-md-0 ml-0 ml-md-4">
                                    <a href="#" class="nav-link1">Road Test Booking</a>
                                </li>
                                <li class="nav-item1 pl-4 pl-md-0 ml-0 ml-md-4">
                                    <a href="/job-opportunity" class="nav-link1">Job Opportunity</a>
                                </li>

                                <li class="nav-item1 pl-4 pl-md-0 ml-0 ml-md-4">
                                    <a href="/make-payment" class="nav-link1" href="#">Make Payment</a>
                                </li>

                                <li class="nav-item1 pl-4 pl-md-0 ml-0 ml-md-4">
                                    <a href="#" class="nav-link1" href="#">Online Course</a>
                                </li>



                                <li class="nav-item1 pl-4 pl-md-0 ml-0 ml-md-4">
                                    <a href="/contact-us" class="nav-link1" href="#">Contacts</a>
                                </li>




                            </ul>
                        </div>

                    </nav>
                </div>
            </div>
        </div>
    </div>


    <div class="About-us-bg">
        <div class="About-us-bg-container">
            <p class="About-us-bg-text-1">Registration Form

            </p>


        </div>
    </div>


    <div class="container mt-5">




        <div class="row">
            <div class="col-sm-8">
                <form class="mt-5 mb-5" id="form">




                    <div class="form-row" id="inner_container">

                        <div class="form-group col-md-12">
                            <label>Name</label>
                            <input type="text" class="form-control" placeholder="Name" name="name">
                        </div>
                        <div class="form-group col-md-12">
                            <label>Email</label>
                            <input type="email" class="form-control" placeholder="Email" name="email">
                        </div>
                        <div class="form-group col-md-12">
                            <label>Phone</label>
                            <input type="number" class="form-control" placeholder="Phone" min="0" name="phone">
                        </div>

                        <div class="form-group col-md-12">
                            <label>  Selected Location </label>
                            <select class="form-control" id="selected_location" disabled>
                            
                          </select>
                            </select>
                        </div>

                        <div class="form-group col-md-12">
                            <label>  Selected Package </label>
                            <select class="form-control" id="selected_package" disabled>
                              
                            </select>
                            </select>
                        </div>


                    </div>

                    <div class="form-group">
                        <label>Preferred Date *</label>
                        <input type="date" class="form-control" placeholder="Subject" name="date">
                    </div>

                    <div class="form-group">
                        <label>Message</label>
                        <textarea class="form-control" placeholder="Message" name="message"></textarea>
                    </div>

                    <button type="submit" class="btn make-payment-btn-1">Send</button>
                </form>
            </div>
            <div class="col-sm-4">

                <div class="card mb-4" id="card_package">

                </div>
            </div>

        </div>



    </div>








    <footer class="section-top-1 ">

        <div class="container">
            <div class="row">
                <div class="col-sm-3">
                    <img src="img/logo.png" class="img-fluid">
                </div>
                <div class="col-sm-3 ">
                    <p class="footer-text-1"> Helpful Links</p>
                    <p class="footer-text-2">
                        Our Services</p>
                    <p class="footer-text-2">
                        Registration Form</p>
                    <p class="footer-text-2">

                        FAQs</p>
                    <p class="footer-text-2">
                        Make Payment</p>
                    <p class="footer-text-2">
                        <a data-toggle="modal" data-target="#myModal">Select Location</a></p>

                    <select class="make-payment-select-2" name="forma1" id="show_locations">
               
</select>

                </div>
                <div class="col-sm-3">
                    <p class="footer-text-1"> Helpful Links</p>
                    <p class="footer-text-2">
                        Our Services</p>
                    <p class="footer-text-2">
                        Registration Form</p>
                    <p class="footer-text-2">

                        FAQs</p>
                    <p class="footer-text-2">
                        Make Payment</p>
                    <p class="footer-text-2">
                        Packages
                    </p>
                </div>
                <div class="col-sm-3">
                    <div class="row">
                        <span class="footericon1 footer-text-1 mb-3 pl-3">Connected Us</span>

                        <div class="col-sm-12">
                            <!-- Add font awesome icons -->
                            <a href="#" class="fa footericon fa-facebook"></a>
                            <a href="#" class="fa footericon fa-twitter"></a>
                            <a href="#" class="fa footericon fa-google"></a>
                            <a href="#" class="fa footericon fa-linkedin"></a>

                        </div>

                    </div>

                </div>
            </div>
        </div>

    </footer>



    <script>
        class UI {


            static showAlert(message, className) {

                const div = document.createElement('div');
                div.className = `alert alert-${className}`;
                div.appendChild(document.createTextNode(message));
                const form = document.querySelector('#form');
                const inner = document.querySelector('#inner_container');
                form.insertBefore(div, inner);

                // Vanish in 3 seconds
                setTimeout(() => document.querySelector('.alert').remove(), 3000);


            }



            static setValues(e) {

                localStorage.removeItem('drivinglocationcanada');
                localStorage.setItem("drivinglocationcanada", e.target.value)

                // const city = e.target.value
                // console.log(city)

                // fetch('/driving-school-getPackageByCityName', {
                //     method: 'POST',
                //     body: JSON.stringify({
                //         location: city
                //     }),
                //     headers: {
                //         'Content-Type': 'application/json'
                //     }
                // }).then(function(response) {
                //     return response.json();
                // }).then(function(data) {

                //     console.log(data)
                //     const bookinfo = {
                //         package: data[0].package,
                //         time: data[0].options[0].time,
                //         description: data[0].options[0].description,
                //         address: data[0].options[0].address,
                //         service: data[0].options[0].service,
                //         phone: data[0].options[0].phone,
                //         location: data[0].location,
                //         price: data[0].options[0].price,
                //     }

                //     //console.log(bookinfo)

                //     localStorage.setItem('bookinginfo', JSON.stringify(bookinfo));

                //     setTimeout(() => {
                //         location.reload()
                //     }, 2000)




                // });

                setTimeout(() => {
                    location.assign('/package')
                }, 3000)


            }


            static populateLocations() {


                fetch('/driving-school-location', {
                    method: 'get',
                }).then(function(response) {
                    return response.json();
                }).then(function(data) {


                    const containers = document.querySelectorAll('#show_locations')

                    containers.forEach(container => {

                        //console.log(locations)
                        data.map(location => {

                            container.innerHTML += `
              <option>${location.location}</option>
          `
                        })
                    })
                });

            }

            static submitForm(e) {

                e.preventDefault()

                const name = e.target.name.value;
                const email = e.target.email.value;
                const phone = e.target.phone.value;
                const myDate = new Date(e.target.date.value);
                const pac = document.querySelector('#selected_package').value;
                const loc = document.querySelector('#selected_location').value;
                const message = e.target.message.value

                if (name === '' || email === '' || phone === '' || myDate === '' || pac === '' || loc === '' || message === '') {
                    UI.showAlert("please fill all fields", "danger")
                    return
                }


                const monthNames = ["January", "February", "March", "April", "May", "June",
                    "July", "August", "September", "October", "November", "December"
                ];

                var month = monthNames[myDate.getMonth()]; //months from 1-12
                var day = myDate.getUTCDate();
                var year = myDate.getUTCFullYear();

                const newdate = month + "/" + day + "/" + year;

                const confirmBooking = {

                    name: name,
                    email: email,
                    phone: phone,
                    package: pac,
                    location: loc,
                    message: message,
                    date: newdate

                }
                console.log(confirmBooking)
                fetch('/user-booking-package', {
                    method: 'post',
                    body: JSON.stringify(confirmBooking),
                    headers: {
                        'Content-Type': 'application/json'
                    }

                }).then(function(response) {
                    return response.json();
                }).then(function(data) {
                    UI.showAlert("Package is booked successfully", "success")
                        //console.log(data)
                    localStorage.removeItem('bookinginfo');

                    setTimeout(() => {
                        location.assign('/package')
                    }, 2000);


                });



            }




            static showBooking() {

                let bookinfo = JSON.parse(localStorage.getItem('bookinginfo'));
                const card = document.getElementById('card_package');
                const option_selected_package = document.querySelector('#selected_package');
                const option_selected_location = document.querySelector('#selected_location');

                option_selected_location.innerHTML = `<option>${bookinfo.location}</option>`
                option_selected_package.innerHTML = `<option>${bookinfo.package}</option>`

                card.innerHTML = `

<div class="card-header"">
                    <h4 class="my-0">${bookinfo.package} </h4>
                </div>
                <div class="card-body">
                    <h1 class="card-title">${bookinfo.price}</h1>
                    <ul class="list-unstyled mt-3 mb-4" id="ul-list">
                      <li>Time : ${bookinfo.time}</li>
                        <li>${bookinfo.description}</li>
                        <li>${bookinfo.address}</li>
                        <li>${bookinfo.service}</li>
                        <li>${bookinfo.phone}</li>
                        <li>${bookinfo.location}</li>
                        </ul>
                </div>



`



            }


        }

        document.addEventListener('DOMContentLoaded', loadFunctions);




        function loadFunctions() {
            const select = document.querySelectorAll('#show_locations');
            const form = document.getElementById('form');
            form.addEventListener('submit', UI.submitForm);


            select.forEach(item => {
                item.addEventListener('click', UI.setValues)
            })
            UI.showBooking()
            UI.populateLocations()
        }
    </script>


</body>

</html>